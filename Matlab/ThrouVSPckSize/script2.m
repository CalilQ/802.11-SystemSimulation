clc
clear all
close all

%% General

nStas = 15;
offeData = 0.5;
simTime = 1.1;

%% With BA and Aggregation

pckSizBA = [50 100 150 200 250 300 350 400 450 550 800 1500 2000]';
%           1       2       3       4       5
thrBA = [2.73595 2.94828 2.97702 2.83879 3.01358;... % 50
    3.32318 3.85597 3.98135 3.54313 3.8167 ;... % 100
    3.72351 4.0651  4.1731  4.11699 4.15308;... % 150
    4.03993 4.2683  4.34511 4.14544 4.3087 ;... % 200
    4.01795 4.61313 4.56198 4.2999  4.39721;... % 250
    3.98115 4.60296 4.63849 4.50331 4.58159;... % 300
    4.13934 4.6531  4.81707 4.39566 4.56062;... % 350
    4.45114 4.80924 4.7213  4.54212 4.51667;... % 400
    4.05669 4.74829 4.83068 4.66178 4.76117;... % 450
    4.29827 4.84864 4.90158 4.51877 4.60651;... % 550
    4.18217 4.90414 4.82487 4.6205  4.74179;... % 800
    4.48788 4.88108 4.83597 4.59483 4.66798;... % 1500
    4.38234 4.81329 5.26397 4.62366 4.9082];    % 2000

mThrBA = mean(thrBA,2)./nStas;
effBA = 100*mThrBA./(simTime*offeData);

%% Without BA and Aggregation

pckSiz = [50 100 150 200 250 300 350 400 450 550 800 1000 1500 2000]';
%         1       2        3        4        5
thr = [1.6032  1.69039  1.79916  1.27477  1.30552;... % 50
    2.29746 2.552    2.65039  2.49031  2.33039;... % 100
    2.9444  3.08516  3.05757  2.8392   2.15249;... % 150
    3.05912 3.5887   3.51938  3.12951  3.44285;... % 200
    3.1058  3.68738  3.75968  3.62162  3.29966;... % 250
    3.31901 3.86389  3.97105  3.41181  3.01422;... % 300
    3.07658 3.99838  4.01357  3.83754  3.19168;... % 350
    3.54152 4.1109   4.31653  4.06711  3.89414;... % 400
    3.8326  4.17085  4.25785  3.7835   3.99942;... % 450
    3.61218 4.55634  4.42979  4.07436  4.18681;... % 550
    3.98582 4.46505  4.76149  4.30365  4.14553;... % 800
    3.98808 4.49307  4.74395  4.33095  4.4553 ;... % 1000
    4.17532 4.97946  4.9074   4.61574  4.70885;... % 1500
    4.42397 5.22896  5.24795  4.93298  4.92123];   % 2000
mThr = mean(thr,2)./nStas;
eff = 100*mThr./(simTime*offeData);

%% Without BA and Aggregation

pckSizNT = [50 100 150 200 250 300 350 400 450 550 800 1000 1500 2000]';
%         1       2        3        4        5
thrNT = [1.01918 1.40718 1.47999 1.16399 1.25959;... % 50
    1.58558 2.19518 2.32717 1.82798 1.94631;... % 100
    1.9704  2.67351 2.84519 2.29079 2.42514;... % 150
    2.208   3.08304 3.25916 2.5776  2.82389;... % 200
    2.38393 3.40799 3.58941 2.90196 3.05385;... % 250
    2.49832 3.56876 3.74635 2.98317 3.20631;... % 300
    2.78279 3.76311 4.0124  3.20875 3.49422;... % 350
    2.79628 3.97436 4.13091 3.39495 3.57759;... % 400
    2.85839 4.11831 4.32717 3.53512 3.546  ;... % 450
    3.09313 4.20963 4.41579 3.55735 3.83225;... % 550
    3.39034 4.60793 4.80633 3.95519 4.12474;... % 800
    3.78264 4.74189 5.06764 4.11607 4.27645;... % 1000
    3.8397  5.14747 5.21974 4.46149 4.3526 ;... % 1500
    4.04733 5.28339 5.40282 4.81229 4.3918 ];   % 2000
mThrNT = mean(thrNT,2)./nStas;
effNT = 100*mThrNT./(simTime*offeData);

%% Plot

fittedBA = fit(pckSizBA,1e3*mThrBA,'smoothingspline');
h1 = plot(fittedBA,'b');
set(h1,'LineWidth',2);
hold on;
plot(pckSizBA,1e3*mThrBA,'bo');
legend off;

axis tight;
xlabel('Dados por pacote [Bytes]');
ylabel('Throughput Médio [kbps]');
grid on;

print('-dbmp','thrVSPckSz_justBA');

fitted = fit(pckSiz,1e3*mThr,'smoothingspline');
h2 = plot(fitted,'r');
set(h2,'LineWidth',2);
hold on;
plot(pckSiz,1e3*mThr,'ro');
legend off;

fittedNT = fit(pckSizNT,1e3*mThrNT,'smoothingspline');
h3 = plot(fittedNT,'g');
set(h3,'LineWidth',2);
hold on;
plot(pckSizNT,1e3*mThrNT,'go');
legend off;

xlabel('Dados por pacote [Bytes]');
ylabel('Throughput Médio [kbps]');
grid on;
axis tight;
hold off;
legend([h1 h2 h3],'Com agregação e TXOP','Sem agregação, com TXOP','Sem agregação e sem TXOP',...
    'Location','SouthEast')

print('-dbmp','thrVSPckSz');

%% Save data

save data2